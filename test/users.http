// Тесты для пользователя

### Запрос на несуществующий путь
GET http://localhost:3000/fake

> {%
    client.test("Запрос на несуществующий путь",
        () => client.assert(response.status === 500, "Response status is not 500"))
%}

### Создание пользователя (Позитив) #1
// @no-cookie-jar
POST http://localhost:3000/signup
Content-Type: application/json

{
  "name": "test name",
  "about": "some text",
  "avatar": "http://example.com/test",
  "email": "{{$random.alphabetic(4)}}@example.com",
  "password": "@Aa12345"
}

> {%
  client.test("Создание пользователя (Позитив) #1",
      () => client.assert(response.status === 200, "Response status is not 200"))
  client.global.set("userId", response.body._id);
  client.global.set("email", response.body.email);
%}

### Создание пользователя (Позитив) #2 [без имени]
// @no-cookie-jar
POST http://localhost:3000/signup
Content-Type: application/json

{
  "email": "{{$random.alphabetic(4)}}@example.com",
  "password": "@Aa12345"
}

> {%
    client.test("Создание пользователя (Позитив) #2 [без имени]",
    () => client.assert(response.status === 200, "Response status is not 200"))
%}

### Создание пользователя (Негатив) [Не корректная структура]
// @no-cookie-jar
POST http://localhost:3000/signup
Content-Type: application/json

{
  "name": ["some name"],
  "about": "some info",
  "avatar": "url"
}

> {%
  client.test("Создание пользователя (Негатив) (Не корректные данные)",
      () => client.assert(response.status === 400, "Response status is not 400"))
%}

### Логин (Позитив)
// @no-cookie-jar
POST http://localhost:3000/signin
Content-Type: application/json

{
  "email": "{{email}}",
  "password": "@Aa12345"
}

> {%
    client.test("Логин (Позитив) #1", () => client.assert(response.status === 200, "Response status is not 200"))
    client.test("Логин (Позитив) #2", () => {
        const token = response.headers.valueOf('set-cookie').split(' ')[0].split('=')[1]
        client.assert(token.length > '0', `Кука не установлена`)
        client.global.set("token", token);
    })
%}

### Логин (Негатив) # 1 [не корректный пароль]
// @no-cookie-jar
POST http://localhost:3000/signin
Content-Type: application/json

{
  "email": "{{email}}",
  "password": "fakeAa1@"
}

> {%
    client.test("Логин (Негатив) # 1 [не корректный пароль]",
        () => client.assert(response.status === 401, "Response status is not 401"))
%}

### Получение всех пользователей (Позитив)
// @no-cookie-jar
GET http://localhost:3000/users
Cookie: authorization={{token}}

> {%
  client.test("Получение всех пользователей (Позитив) #1", () => client.assert(response.status === 200, "Response status is not 200"))
  client.test("Получение всех пользователей (Позитив) #2", () => client.assert(response.body.length > 0, "Тело ответа пустое"))
%}

### Получение всех пользователей (Негатив)
// @no-cookie-jar
GET http://localhost:3000/users

> {%
    client.test("Получение всех пользователей (Негатив) #1", () => client.assert(response.status === 401, "Response status is not 401"))
%}

### Получение конкретного пользователя (Позитив)
// @no-cookie-jar
GET http://localhost:3000/users/{{userId}}
Cookie: authorization={{token}}

> {%
  client.test("Получение конкретного пользователя (Позитив)", () => client.assert(response.status === 200, "Response status is not 200"))
%}

### Получение конкретного пользователя (Негатив) #1 (не существующий пользователь)
// @no-cookie-jar
GET http://localhost:3000/users/654b6a5e7b1ccc27ce2cc78d
Cookie: authorization={{token}}

> {%
  client.test("Получение конкретного пользователя (Негатив) #1 (не существующий пользователь)",
      () => client.assert(response.status === 404, "Response status is not 404"))
%}

### Получение конкретного пользователя (Негатив) #2 (не корректный id)
// @no-cookie-jar
GET http://localhost:3000/users/654b6a5e7b1ccc
Cookie: authorization={{token}}

> {%
    client.test("Получение конкретного пользователя (Негатив) #1 (не существующий пользователь)",
        () => client.assert(response.status === 400, "Response status is not 400"))
%}

### Обновление данных пользователя (Позитив)
// @no-cookie-jar
PATCH http://localhost:3000/users/me
Cookie: authorization={{token}}
Content-Type: application/json

{
  "name": "some name1",
  "about": "some info2"
}
> {%
  client.test("Обновление данных пользователя (Позитив)",
      () => client.assert(response.status === 200, "Response status is not 200"))
%}

### Обновление данных пользователя (Негатив)
// @no-cookie-jar
PATCH http://localhost:3000/users/me
Cookie: authorization={{token}}
Content-Type: application/json

{
  "name": ["some name1"],
  "about": "some info2"
}
> {%
  client.test("Обновление данных пользователя (Негатив)", () => client.assert(response.status === 500, "Response status is not 500"))
%}


### Обновление аватарки (Позитив)
// @no-cookie-jar
PATCH http://localhost:3000/users/me/avatar
Cookie: authorization={{token}}
Content-Type: application/json

{
  "avatar": "url3@example.com"
}
> {%
  client.test("Обновление аватарки (Позитив)", () => client.assert(response.status === 200, "Response status is not 200"))
%}

### Обновление аватарки (Негатив)
// @no-cookie-jar
PATCH http://localhost:3000/users/me/avatar
Cookie: authorization={{token}}
Content-Type: application/json

{
  "avatar": ["url3"]
}
> {%
  client.test("Обновление аватарки (Негатив)", () => client.assert(response.status === 500, "Response status is not 500"))
%}